// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           String    @id @default(uuid())
  name         String    @db.VarChar(60)
  birth_date   DateTime? @db.Date
  phone        String    @db.VarChar(9)
  email        String    @db.VarChar(45)
  cpf          String    @unique @db.VarChar(11)
  sex          String?   @db.VarChar(15)
  date_created DateTime  @default(now())
  role         String    @db.VarChar(12)
  username     String    @unique
  password     String    @db.VarChar(20)
  orders       Order[]

  @@map("user")
}

model Product {
  id                String            @id @default(uuid())
  product_type      String            @db.VarChar(25)
  collection        String            @db.VarChar(40)
  name              String            @db.VarChar(50)
  date_created      DateTime          @default(now())
  value             Int               @db.Integer
  id_promotion      String?
  promotion         Promotion?        @relation(fields: [id_promotion], references: [id])
  product_has_order ProductHasOrder[]
  product_has_size  ProductHasSize[]

  PromotionHasProduct PromotionHasProduct[]
  @@map("product")
}

model Size {
  id               Int              @id @default(autoincrement())
  productSize      String           @db.VarChar(13)
  product_has_size ProductHasSize[]

  @@map("size")
}

model ProductHasSize {
  fk_id_product String
  fk_id_size    Int
  qtd           Int     @db.Integer
  product       Product @relation(fields: [fk_id_product], references: [id])
  size          Size    @relation(fields: [fk_id_size], references: [id])

  @@id([fk_id_product, fk_id_size])
  @@map("product_has_size")
}

model Promotion {
  id         String    @id @default(uuid())
  name       String    @db.VarChar(30)
  start_date DateTime  @default(now())
  end_date   DateTime?
  discount   String?   @db.VarChar(15)
  products   Product[]

  PromotionHasProduct PromotionHasProduct[]
  @@map("promotion")
}

model PromotionHasProduct {
  fk_id_product   String
  fk_id_promotion String
  product         Product   @relation(fields: [fk_id_product], references: [id])
  promotion       Promotion @relation(fields: [fk_id_promotion], references: [id])

  @@id([fk_id_product, fk_id_promotion])
  @@map("promotion_has_product")
}

//Analisar order nessa tabela
//Analisar o porque cadastrar opções de pagamento
model PaymentOptions {
  id          String  @id @default(uuid())
  name        String  @db.VarChar(20)
  flag        String? @db.VarChar(20)
  installment String? @default("Sem Parcelamento") @db.VarChar(20)
  order       Order?

  @@map("payment_options")
}

model Order {
  id                    String            @id @default(uuid())
  date_created          DateTime          @default(now()) @db.Date
  fk_id_payment_options String            @unique
  fk_id_user            String
  is_open               Boolean           @default(true)
  user                  User              @relation(fields: [fk_id_user], references: [id])
  payment_option        PaymentOptions    @relation(fields: [fk_id_payment_options], references: [id])
  product_has_order     ProductHasOrder[]
  sale                  Sale[]

  @@map("order")
}

model Sale {
  id             String   @id @default(uuid())
  date_submitted DateTime @default(now()) @db.Date
  fk_id_order    String
  order          Order    @relation(fields: [fk_id_order], references: [id])

  @@map("sale")
}

model ProductHasOrder {
  qtdOrder      Int     @db.Integer
  fk_id_product String
  fk_id_order   String
  hasPromotion  Boolean @default(false)
  products      Product @relation(fields: [fk_id_product], references: [id])
  order         Order   @relation(fields: [fk_id_order], references: [id])

  @@id([fk_id_product, fk_id_order])
  @@map("product_has_order")
}
